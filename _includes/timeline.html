{% comment %}
Timeline component with event highlighting.
Supports event states: past, current, upcoming
Automatically determines state based on date if not specified
{% endcomment %}

<section aria-labelledby="cohort-timeline" class="overflow-hidden rounded-2xl border border-brand-sky/10 bg-white shadow-subtle">
  <div class="border-b border-brand-sky/10 bg-brand-sky/5 px-6 py-4">
    <h2 id="cohort-timeline" class="text-lg font-semibold text-brand-navy">{{ include.title | default: 'Key events' }}</h2>
    <p class="text-xs uppercase tracking-[0.28em] text-brand-cloud">{{ include.subtitle | default: 'Milestones for this cohort' }}</p>
  </div>
  <div class="relative px-6 py-6 sm:py-8">
    <span class="pointer-events-none absolute left-6 top-0 bottom-0 w-px bg-gradient-to-b from-brand-sky/40 via-brand-indigo/30 to-brand-sea/30" aria-hidden="true"></span>
    <ol class="space-y-6">
      {% for event in include.events %}
        {% assign event_state = event.state | default: 'upcoming' %}
        {% assign now = 'now' | date: '%s' | plus: 0 %}
        {% if event.date %}
          {% assign event_date = event.date | date: '%s' | plus: 0 %}
          {% if event_date < now %}
            {% assign event_state = 'past' %}
          {% endif %}
        {% endif %}

        {% comment %}Determine icon based on event type or ID{% endcomment %}
        {% assign icon_name = event.icon | default: 'info' %}
        {% if event.id contains 'kickoff' or event.type == 'kickoff' %}
          {% assign icon_name = 'plus' %}
        {% elsif event.id contains 'midpoint' or event.type == 'midpoint' %}
          {% assign icon_name = 'check' %}
        {% elsif event.id contains 'final' or event.type == 'final' %}
          {% assign icon_name = 'check' %}
        {% endif %}

        {% comment %}Determine colors based on event state{% endcomment %}
        {% case event_state %}
          {% when 'past' %}
            {% assign card_class = 'border-brand-cloud/20 bg-white/50 opacity-75' %}
            {% assign icon_bg = 'bg-brand-cloud/20 text-brand-cloud' %}
          {% when 'current' %}
            {% assign card_class = 'border-brand-indigo/30 bg-gradient-to-br from-white to-brand-sky/5 shadow-card' %}
            {% assign icon_bg = 'bg-brand-indigo text-white shadow-subtle' %}
          {% else %}
            {% assign card_class = 'border-brand-sky/15 bg-white/80' %}
            {% assign icon_bg = 'bg-brand-sky/15 text-brand-indigo' %}
        {% endcase %}

        {% assign event_year = include.year | default: page.year %}
        {% assign event_slug = event.slug | default: event.id | default: event.name | slugify %}
        {% assign event_href = '/cohorts/' | append: event_year | append: '/events/' | append: event_slug | append: '/' | relative_url %}
        {% assign is_next = include.next_slug and include.next_slug == event_slug %}
        <li class="group relative ml-10 rounded-2xl border transition-all duration-300 ease-out {{ card_class }} p-5 shadow-subtle backdrop-blur hover:-translate-y-0.5 hover:shadow-card hover:border-brand-sky/30 {% if is_next %}ring-2 ring-brand-indigo/30 bg-brand-indigo/5{% endif %}">
          <a class="absolute inset-0 rounded-2xl focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-brand-sky/30" href="{{ event_href }}" aria-label="View details for {{ event.name }}"></a>
          <div class="absolute left-[-46px] top-1 flex h-10 w-10 items-center justify-center rounded-full transition-all duration-300 {{ icon_bg }} shadow-subtle group-hover:scale-110">
            {% include icon.html name=icon_name size='md' %}
          </div>
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <p class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-cloud">
                <span class="inline-flex items-center gap-1">
                  {% include icon.html name='calendar' size='xs' class='text-brand-sky' %}
                  {{ event.date | date: "%B %-d, %Y" }}
                </span>
                {% if event_state == 'current' %}
                  <span class="ml-2 rounded-full bg-brand-indigo/15 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-brand-indigo">Current</span>
                {% endif %}
              </p>
              <h3 class="mt-2 text-lg font-semibold text-brand-navy transition-colors group-hover:text-brand-indigo {% if is_next %}text-brand-indigo{% endif %}">{{ event.name }}</h3>
            </div>
            {% if event.type %}
              {% include badge.html label=event.type tone='neutral' size='sm' %}
            {% endif %}
          </div>
          <div class="mt-2 space-y-1 text-sm text-brand-stone">
            {% if event.time %}
              <p class="flex items-center gap-2">
                {% include icon.html name='clock' size='sm' class='text-brand-sky' %}
                <span>{{ event.time }}</span>
              </p>
            {% endif %}
            {% if event.location %}
              <p class="flex items-center gap-2">
                {% include icon.html name='location-pin' size='sm' class='text-brand-sky' %}
                <span>{{ event.location }}</span>
              </p>
            {% endif %}
            {% if event.description %}<p class="mt-2 leading-relaxed">{{ event.description }}</p>{% endif %}
            <p class="mt-3 inline-flex items-center gap-2 text-sm font-semibold text-brand-sky">
              <span>View details</span>
              <svg class="h-4 w-4 transition group-hover:translate-x-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14m0 0-5 5m5-5-5-5"/></svg>
            </p>
          </div>
        </li>
      {% endfor %}
    </ol>
  </div>
</section>
