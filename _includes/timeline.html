{% comment %}
Timeline component with event highlighting.
Supports event states: past, current, upcoming
Automatically determines state based on date if not specified
{% endcomment %}

<section aria-labelledby="cohort-timeline" class="overflow-hidden rounded-2xl border border-brand-sky/10 bg-white shadow-subtle">
  <div class="border-b border-brand-sky/10 bg-brand-sky/5 px-6 py-4">
    <h2 id="cohort-timeline" class="text-lg font-semibold text-brand-navy">{{ include.title | default: 'Key events' }}</h2>
    <p class="text-xs uppercase tracking-[0.28em] text-brand-cloud">{{ include.subtitle | default: 'Milestones for this cohort' }}</p>
  </div>
  <div class="relative px-6 py-6 sm:py-8">
    <span class="pointer-events-none absolute left-6 top-0 bottom-0 w-px bg-gradient-to-b from-brand-sky/40 via-brand-indigo/30 to-brand-sea/30" aria-hidden="true"></span>
    <ol class="space-y-6">
      {% for event in include.events %}
        {% assign event_state = event.state | default: 'upcoming' %}
        {% assign now = 'now' | date: '%s' | plus: 0 %}
        {% if event.date %}
          {% assign event_date = event.date | date: '%s' | plus: 0 %}
          {% if event_date < now %}
            {% assign event_state = 'past' %}
          {% endif %}
        {% endif %}

        {% comment %}Determine icon based on event type or ID{% endcomment %}
        {% assign icon_name = event.icon | default: 'info' %}
        {% if event.id contains 'kickoff' or event.type == 'kickoff' %}
          {% assign icon_name = 'plus' %}
        {% elsif event.id contains 'midpoint' or event.type == 'midpoint' %}
          {% assign icon_name = 'check' %}
        {% elsif event.id contains 'final' or event.type == 'final' %}
          {% assign icon_name = 'check' %}
        {% endif %}

        {% comment %}Determine colors based on event state{% endcomment %}
        {% case event_state %}
          {% when 'past' %}
            {% assign card_class = 'border-brand-cloud/20 bg-white/50 opacity-75' %}
            {% assign icon_bg = 'bg-brand-cloud/20 text-brand-cloud' %}
          {% when 'current' %}
            {% assign card_class = 'border-brand-indigo/30 bg-gradient-to-br from-white to-brand-sky/5 shadow-card' %}
            {% assign icon_bg = 'bg-brand-indigo text-white shadow-subtle' %}
          {% else %}
            {% assign card_class = 'border-brand-sky/15 bg-white/80' %}
            {% assign icon_bg = 'bg-brand-sky/15 text-brand-indigo' %}
        {% endcase %}

        <li class="group relative ml-10 rounded-2xl border transition-all duration-300 ease-out {{ card_class }} p-5 shadow-subtle backdrop-blur hover:-translate-y-0.5 hover:shadow-card hover:border-brand-sky/30">
          <div class="absolute left-[-46px] top-1 flex h-10 w-10 items-center justify-center rounded-full transition-all duration-300 {{ icon_bg }} shadow-subtle group-hover:scale-110">
            {% include icon.html name=icon_name size='md' %}
          </div>
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <p class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-cloud">
                {{ event.date | date: "%B %-d, %Y" }}
                {% if event_state == 'current' %}
                  <span class="ml-2 rounded-full bg-brand-indigo/15 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-brand-indigo">Current</span>
                {% endif %}
              </p>
              <h3 class="mt-2 text-lg font-semibold text-brand-navy transition-colors group-hover:text-brand-indigo">{{ event.name }}</h3>
            </div>
            {% if event.type %}
              {% include badge.html label=event.type tone='neutral' size='sm' %}
            {% endif %}
          </div>
          <div class="mt-2 space-y-1 text-sm text-brand-stone">
            {% if event.time %}<p><strong class="font-semibold text-brand-sky">Time:</strong> {{ event.time }}</p>{% endif %}
            {% if event.location %}<p><strong class="font-semibold text-brand-sky">Location:</strong> {{ event.location }}</p>{% endif %}
            {% if event.description %}<p class="mt-2 leading-relaxed">{{ event.description }}</p>{% endif %}
          </div>
        </li>
      {% endfor %}
    </ol>
  </div>
</section>
