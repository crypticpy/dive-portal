<!DOCTYPE html>
<html lang="en">
  {% include head.html %}
  <body class="bg-surface-base text-brand-slate">
    <a class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-1/2 focus:-translate-x-1/2 focus:rounded-full focus:bg-brand-sky focus:px-5 focus:py-3 focus:text-white focus:shadow-subtle" href="#main-content">Skip to content</a>
    <div class="relative flex min-h-screen flex-col overflow-hidden">
      <div aria-hidden="true" class="pointer-events-none absolute inset-x-0 top-[-40vh] h-[60vh] bg-hero-radial opacity-70"></div>
      <div aria-hidden="true" class="pointer-events-none absolute inset-x-0 bottom-[-45vh] h-[55vh] bg-card-gradient blur-3xl"></div>

      {% include header.html %}

      <main id="main-content" class="relative z-10 flex-1">
        <div class="mx-auto w-full max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
          {{ content }}
        </div>
      </main>

      {% include footer.html %}
    </div>
    {% if page.include_filters %}
      <script defer src="{{ '/assets/js/filters.js' | relative_url }}"></script>
    {% endif %}
    {% if page.include_search %}
      <script defer src="{{ '/assets/js/lunr.min.js' | relative_url }}"></script>
      <script defer src="{{ '/assets/js/search.js' | relative_url }}"></script>
    {% endif %}
    <script>
      (function () {
        const header = document.querySelector('[data-component="site-header"]');
        const toggle = document.querySelector('[data-nav-toggle]');
        const panel = document.querySelector('[data-nav-panel]');
        if (!header || !toggle || !panel) return;

        const closePanel = () => {
          panel.classList.add('hidden');
          toggle.setAttribute('aria-expanded', 'false');
        };

        toggle.addEventListener('click', () => {
          const expanded = toggle.getAttribute('aria-expanded') === 'true';
          toggle.setAttribute('aria-expanded', String(!expanded));
          panel.classList.toggle('hidden');
        });

        panel.addEventListener('click', (event) => {
          if (event.target.matches('a')) {
            closePanel();
          }
        });

        window.addEventListener('resize', () => {
          if (window.innerWidth >= 1024) {
            closePanel();
          }
        });

        let lastY = window.scrollY;
        const updateHeader = () => {
          const offset = window.scrollY;
          const target = header.querySelector('div.absolute');
          if (!target) return;

          // Gradual transition between 0-50px scroll
          const scrollProgress = Math.min(offset / 50, 1);
          const shouldEnhance = offset > 20;

          if (shouldEnhance) {
            target.classList.add('backdrop-blur-md', 'shadow-subtle');
            // Gradual opacity from 0.92 to 0.98
            target.style.opacity = String(0.92 + (scrollProgress * 0.06));
          } else {
            target.classList.remove('backdrop-blur-md', 'shadow-subtle');
            target.style.opacity = '';
          }

          lastY = offset;
        };
        updateHeader();
        window.addEventListener('scroll', () => {
          window.requestAnimationFrame(updateHeader);
        });
      })();
    </script>
  </body>
</html>
